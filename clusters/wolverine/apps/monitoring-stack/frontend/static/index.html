<!DOCTYPE html>
<html>
<head>
    <title>NKP-CICD Monitoring</title>
    <style>
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Segoe UI',sans-serif; background:linear-gradient(135deg,#667eea 0%,#764ba2 100%); color:white; min-height:100vh; }
        .container { max-width:1200px; margin:0 auto; padding:20px; }
        h1 { text-align:center; margin-bottom:30px; font-size:2.5em; }
        .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(350px,1fr)); gap:20px; }
        .card { background:rgba(255,255,255,0.1); backdrop-filter:blur(10px); padding:25px; border-radius:20px; border:1px solid rgba(255,255,255,0.2); }
        .metric { font-size:1.5em; margin:10px 0; }
        .status { padding:10px; border-radius:8px; margin:10px 0; }
        .running { background:#10b981; }
        .pending { background:#f59e0b; }
        table { width:100%; border-collapse:collapse; margin-top:15px; }
        th,td { padding:12px; text-align:left; border-bottom:1px solid rgba(255,255,255,0.1); }
        th { background:rgba(0,0,0,0.2); }
        .refresh { position:fixed; bottom:20px; right:20px; background:#10b981; color:white; border:none; padding:15px 20px; border-radius:50px; cursor:pointer; font-size:16px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ NKP-CICD Live Monitoring</h1>
        <div id="timestamp"></div>
        
        <div class="grid">
            <div class="card">
                <h2>üì¶ Pods (apps namespace)</h2>
                <div id="pods"></div>
            </div>
            
            <div class="card">
                <h2>üåê Services</h2>
                <div id="services"></div>
            </div>
            
            <div class="card">
                <h2>üîå External IPs</h2>
                <table id="external-ips">
                    <tr><th>Service</th><th>External IP</th></tr>
                </table>
            </div>
        </div>
    </div>
    
    <button class="refresh" onclick="loadData()">üîÑ Refresh</button>
    
    <script>
        async function loadData() {
            try {
                const res = await fetch('/api/status');
                const data = await res.json();
                
                document.getElementById('timestamp').innerHTML = 
                    `<p style="text-align:center;font-size:1.2em;">Updated: ${data.timestamp}</p>`;
                
                // Pods
                let podsHTML = '';
                data.pods.forEach(pod => {
                    const statusClass = pod.status === 'Running' ? 'running' : 'pending';
                    podsHTML += `<div class="status ${statusClass}">${pod.name} (${pod.status}) on ${pod.node || 'N/A'}</div>`;
                });
                document.getElementById('pods').innerHTML = podsHTML || '<p>No pods</p>';
                
                // Services
                let svcsHTML = '';
                data.services.forEach(svc => {
                    svcsHTML += `<div class="status">${svc.name}: ${svc.type} (${svc.cluster_ip})</div>`;
                });
                document.getElementById('services').innerHTML = svcsHTML || '<p>No services</p>';
                
                // External IPs
                let ipsHTML = '<tr><td colspan="2">No external IPs</td></tr>';
                if (Object.keys(data.externalIPs).length > 0) {
                    ipsHTML = '';
                    Object.entries(data.externalIPs).forEach(([svc, ip]) => {
                        ipsHTML += `<tr><td>${svc}</td><td>${ip}</td></tr>`;
                    });
                }
                document.getElementById('external-ips').innerHTML = `<tr><th>Service</th><th>External IP</th></tr>${ipsHTML}`;
                
            } catch(e) {
                document.getElementById('pods').innerHTML = '<p>Error loading data</p>';
            }
        }
        
        loadData();
        setInterval(loadData, 5000);
    </script>
</body>
</html>


# Fluent Bit config: ship nginx logs to Kafka (use when Kafka is deployed).
# Apply this to replace the default stdout config: same ConfigMap name.
# Requires: Kafka cluster + topic monitoring-logs in namespace kafka.
apiVersion: v1
kind: ConfigMap
metadata:
  name: fluent-bit-frontend-config
  namespace: apps
data:
  fluent-bit.conf: |
    [SERVICE]
        Flush         1
        Log_Level     info

    [INPUT]
        Name          tail
        Path          /var/log/nginx/access.log
        Read_from_Head true
        Tag           nginx.access
        Refresh_Interval 5

    [INPUT]
        Name          tail
        Path          /var/log/nginx/error.log
        Read_from_Head true
        Tag           nginx.error
        Refresh_Interval 5

    [FILTER]
        Name          modify
        Match         nginx.*
        Add           source monitoring-frontend

    [OUTPUT]
        Name          kafka
        Match         nginx.*
        Brokers       cluster-kafka-bootstrap.kafka.svc.cluster.local:9092
        Topics        monitoring-logs
        Format        json_stream
